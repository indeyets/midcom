if(console==undefined){var console={};console.log=function(aa){return;}}
function finishCalendarLoad(id){jQuery('#'+id).fadeIn("",function(){on_view_update();var ba=calendar_config["types_classes"][calendar_config["type"]];if(ba=='week'||ba=='day'){jQuery('div.calendar-timeline-holder')[0].scrollTop=calendar_config["start_hour_x"];}});}
function run_scripts(e){console.log("run_scripts in "+e);if(e.nodeType!=1)return;if(e.tagName.toLowerCase()=='script'){console.log("execute scripts in "+e);console.log("execute scripts: "+e.text);eval(e.text);}
else{var n=e.firstChild;while(n){if(n.nodeType==1)run_scripts(n);n=n.nextSibling;}}}
function zoom_view(ca,da){if(ca){if(calendar_config["type"]==4){return false;}
calendar_config["type"]+=1;}
else{if(calendar_config["type"]==1){return false;}
calendar_config["type"]-=1;}
var ea=jQuery('#date-selection-form');var fa=APPLICATION_PREFIX+da+calendar_config["timestamp"]+'/'+calendar_config["type"];console.log("ajax_url: "+fa);jQuery.ajaxSetup({global:true});jQuery.ajax({url:fa,timeout:12000,error:function(ga,ha,ia){alert("Failed to zoom request.statusText: "+ga.statusText);jQuery('#calendar-holder').show();},success:function(r){jQuery('#calendar-holder').html(unescape(r));var ja=calendar_config["types_classes"][calendar_config["type"]];jQuery('body').attr('class',ja);setTimeout("finishCalendarLoad('calendar-holder')",400);}});return false;}
function update_date_selection(ka,la,ma){var na=[];var oa=jQuery('#date-selection-form');jQuery(':input',oa).each(function(){if(this.name=="month-select"){this.value=la;}
if(this.name=="day-select"){this.value=ka;}
if(this.name=="year-select"){this.value=ma;}
na.push(this.name+'='+escape(this.value));});return na;}
function goto_prev(){var pa=new Date();var qa=pa.getDate();var ra=pa.getMonth();var sa=pa.getFullYear();var ta=new Date(qa,ra,sa);var ua=jQuery('#date-selection-form');jQuery(':input',ua).each(function(){if(this.name=="month-select"){ra=this.value-1;}
if(this.name=="day-select"){qa=this.value;}
if(this.name=="year-select"){sa=this.value;}});ta.setDate(qa);ta.setMonth(ra);ta.setYear(sa);console.log("newDate before: "+ta);if(calendar_config["type"]==1){ta.setYear(ta.getFullYear()-1);}
if(calendar_config["type"]==2){ta.setMonth((ta.getMonth()-1));}
if(calendar_config["type"]==3){ta.setDate((ta.getDate()-7));}
if(calendar_config["type"]==4){ta.setDate((ta.getDate()-1));}
var va=String((ta.getMonth()+1));if(va.length<2){va="0"+va;}
var wa=String((ta.getDate()));if(wa.length<2){wa="0"+wa;}
var xa=update_date_selection(wa,va,ta.getFullYear());timestamp=ta.getTime()/1000.0;calendar_config["timestamp"]=timestamp;var ya=APPLICATION_PREFIX+'ajax/change/date/'+calendar_config["timestamp"]+'/'+calendar_config["type"];jQuery.ajaxSetup({global:true});jQuery.ajax({data:xa.join('&'),url:ya,timeout:12000,error:function(za,Aa,Ba){alert("Failed to change date");jQuery('#calendar-holder').show();},success:function(r){jQuery('#calendar-holder').html(unescape(r));setTimeout("finishCalendarLoad('calendar-holder')",400);}});}
function goto_next(){var Ca=new Date();var Da=Ca.getDate();var Ea=Ca.getMonth();var Fa=Ca.getFullYear();var Ga=new Date(Da,Ea,Fa);var Ha=jQuery('#date-selection-form');jQuery(':input',Ha).each(function(){if(this.name=="day-select"){Da=this.value;}
if(this.name=="month-select"){Ea=this.value-1;}
if(this.name=="year-select"){Fa=this.value;}});Ga.setDate(Da);Ga.setMonth(Ea);Ga.setYear(Fa);console.log("newDate before: "+Ga);if(calendar_config["type"]==1){Ga.setYear(Ga.getFullYear()+1);}
if(calendar_config["type"]==2){Ga.setMonth((Ga.getMonth()+1));}
if(calendar_config["type"]==3){Ga.setDate((Ga.getDate()+7));}
if(calendar_config["type"]==4){Ga.setDate((Ga.getDate()+1));}
var Ia=String((Ga.getMonth()+1));if(Ia.length<2){Ia="0"+Ia;}
var Ja=String((Ga.getDate()));if(Ja.length<2){Ja="0"+Ja;}
var Ka=update_date_selection(Ja,Ia,Ga.getFullYear());timestamp=Ga.getTime()/1000.0;console.log("newDate: "+Ga);calendar_config["timestamp"]=timestamp;var La=APPLICATION_PREFIX+'ajax/change/date/'+calendar_config["timestamp"]+'/'+calendar_config["type"];jQuery.ajaxSetup({global:true});jQuery.ajax({data:Ka.join('&'),url:La,timeout:12000,error:function(Ma,Na,Oa){alert("Failed to change date");jQuery('#calendar-holder').show();},success:function(r){jQuery('#calendar-holder').html(unescape(r));setTimeout("finishCalendarLoad('calendar-holder')",400);}});}
function goto_today(){var Pa=jQuery('#date-selection-form');var Qa=new Date();var Ra=Qa.getDate();var Sa=Qa.getMonth();var Ta=Qa.getFullYear();var Ua=String((Sa+1));if(Ua.length<2){Ua="0"+Ua;}
var Va=update_date_selection(Ra,Ua,Ta);var Wa=new Date(Ta,Sa,Ra);timestamp=Wa.getTime()/1000.0;calendar_config["timestamp"]=timestamp;var Xa=APPLICATION_PREFIX+'ajax/change/date/'+calendar_config["timestamp"]+'/'+calendar_config["type"];jQuery.ajaxSetup({global:true});jQuery.ajax({data:Va.join('&'),url:Xa,timeout:12000,error:function(Ya,Za,$a){alert("Failed to change date");jQuery('#calendar-holder').show();},success:function(r){jQuery('#calendar-holder').html(unescape(r));setTimeout("finishCalendarLoad('calendar-holder')",400);}});return false;}
function change_date(){var ab=jQuery('#date-selection-form');var bb=new Date();var cb=[];var db=bb.getDate();var eb=bb.getMonth();var fb=bb.getFullYear();jQuery(':input',ab).each(function(){if(this.name=="month-select"){eb=this.value-1;}
if(this.name=="day-select"){db=this.value;}
if(this.name=="year-select"){fb=this.value;}
cb.push(this.name+'='+escape(this.value));});var gb=new Date(fb,eb,db);timestamp=gb.getTime()/1000.0;calendar_config["timestamp"]=timestamp;var hb=APPLICATION_PREFIX+'ajax/change/date/'+calendar_config["timestamp"]+'/'+calendar_config["type"];jQuery.ajaxSetup({global:true});jQuery.ajax({data:cb.join('&'),url:hb,timeout:12000,error:function(ib,jb,kb){alert("Failed to change date");jQuery('#calendar-holder').show();},success:function(r){jQuery('#calendar-holder').html(unescape(r));setTimeout("finishCalendarLoad('calendar-holder')",400);}});return false;};function change_timezone(){var lb=jQuery('#timezone-selection-form');var mb=null;var nb=[];jQuery(':input',lb).each(function(){if(this.name=="timezone"){mb=this.value-1;}
nb.push(this.name+'='+escape(this.value));});var ob=APPLICATION_PREFIX+'ajax/change/timezone/'+calendar_config["timestamp"]+'/'+calendar_config["type"];jQuery.ajaxSetup({global:true});jQuery.ajax({data:nb.join('&'),url:ob,timeout:12000,error:function(pb,qb,rb){alert("Failed to change timezone");jQuery('#calendar-holder').show();},success:function(r){jQuery('#calendar-holder').html(unescape(r));setTimeout("finishCalendarLoad('calendar-holder')",400);}});return false;};function create_event(sb){var tb="ajax/event/create/"+sb;if(active_shelf_item){tb="ajax/event/move/"+active_shelf_item+"/"+sb;}
load_modal_window(tb);}
function close_create_event(){close_modal_window();return;}
function load_modal_window(ub){var vb=jQuery("div.calendar-modal-window");if(ub.substr(0,7)!='midcom-'){ub=APPLICATION_PREFIX+ub;}
else{ub=HOST_PREFIX+ub;}
jQuery.ajaxSetup({global:false});jQuery.ajax({type:"GET",url:ub,timeout:12000,error:function(wb,xb,yb){console.log("Failed to load modal window! type: "+xb);console.log("request.statusText: "+wb.statusText);if(wb.statusText=="Forbidden"){window.location=HOST_PREFIX+'midcom-login-';}},success:function(r){vb.html(unescape(r));jQuery("div.calendar-modal-window").show();}});}
function close_modal_window(){jQuery("div.calendar-modal-window").hide();return;}
function set_modal_window_contents(zb){jQuery("div.calendar-modal-window").html(unescape(zb));}
function load_shelf_contents(){var Ab='midcom-exec-org.maemo.calendar/shelf.php?action=load';jQuery.ajaxSetup({global:false});jQuery.ajax({type:"GET",url:HOST_PREFIX+Ab,timeout:12000,dataType:'json',error:function(Bb,Cb,Db){console.log("Failed to load shelf content");},success:function(r){shelf_contents=r;console.log('Loaded Shelf content from the server: '+shelf_contents);hide_shelf_events_from_view();}});}
function save_shelf_contents(){console.log('save_shelf_contents: '+shelf_contents);var Eb='midcom-exec-org.maemo.calendar/shelf.php?action=save';jQuery.ajaxSetup({global:false});jQuery.ajax({type:"POST",url:HOST_PREFIX+Eb,data:{data:protoToolkit.toJSON(shelf_contents)},timeout:12000,error:function(Fb,Gb,Hb){alert("Failed to save shelf content! exception type: "+Gb);},success:function(Ib){update_shelf_panel_leaf();hide_shelf_events_from_view();console.log('Saved Shelf content to the server: '+Ib);}});}
function update_shelf_panel_leaf(){var Jb='midcom-exec-org.maemo.calendar/shelf.php?action=update_list';jQuery.ajaxSetup({global:false});jQuery.ajax({type:"GET",url:HOST_PREFIX+Jb,timeout:12000,dataType:'script',error:function(Kb,Lb,Mb){alert("Failed to update shelf list");},success:function(r){console.log('Updated Shelf list with content from the server: '+r);}});}
function hide_shelf_events_from_view(){console.log('hide_shelf_events_from_view');jQuery.each(shelf_contents,function(i,n){console.log('hide event with id event-'+n.guid);jQuery('#event-'+n.guid).hide().attr({in_shelf:'true'});jQuery('div.event-toolbar-holder div.event-toolbar:visible').hide();});}
function unhide_shelf_events_from_view(){console.log('unhide_shelf_events_from_view');jQuery.each(shelf_contents,function(i,n){console.log('unhide event with id event-'+n.guid);jQuery('#event-'+n.guid).show().attr({in_shelf:'false'});});}
function move_event_to_shelf(Nb,Ob){console.log('move_event_to_shelf: '+Nb);var Pb=jQuery.grep(shelf_contents,function(n,i){return n.guid==Nb;});console.log('existing: '+Pb);console.log('existing.length: '+Pb.length);if(Pb.length==0){console.log('Event isnt in the shelf yet. Add it now.');var Qb=shelf_contents.push({guid:Nb,data:Ob});console.log('shelf_contents['+(Qb-1)+']: '+shelf_contents[Qb-1]);console.log('shelf_contents['+(Qb-1)+'].data.title: '+shelf_contents[Qb-1].data.title);save_shelf_contents();}
else{console.log('Event is in the shelf already. Do nothing');}}
function activate_shelf_item(Rb){console.log('activate_shelf_item: '+Rb);var Sb=jQuery.grep(shelf_contents,function(n,i){return n.guid==Rb;});if(Sb.length>0){console.log('Event is in the shelf');if(active_shelf_item&&jQuery('#shelf-item-list li.active')[0].id=='shelf-list-item-'+Rb){console.log('Already active, deactivating');active_shelf_item=false;jQuery('#shelf-item-list li.active').attr('class','');}
else{console.log('activating');jQuery('#shelf-item-list li.active').attr('class','');active_shelf_item=Rb;jQuery('#shelf-list-item-'+Rb).attr('class','active');}}
else{console.log('Event isnt in the shelf!');}}
function attach_active_shelf_item(Tb,Ub){console.log("attach_active_shelf_item timestamp: "+Tb+" identifier: "+Ub);}
function empty_shelf(){var Vb='midcom-exec-org.maemo.calendar/shelf.php?action=empty';jQuery.ajaxSetup({global:false});jQuery.ajax({type:"GET",url:HOST_PREFIX+Vb,timeout:12000,error:function(Wb,Xb,Yb){alert("Failed to empty shelf list");},success:function(r){unhide_shelf_events_from_view();shelf_contents=Array();jQuery('#shelf-item-list').html('');console.log('Emptied Shelf list with response from the server: '+r);}});}
function show_event_delete_form(Zb){console.log('show_event_delete_form '+Zb);var $b='ajax/event/delete/'+Zb;load_modal_window($b);}
function enable_event_delete_form(ac){console.log('enable_event_delete_form '+ac);var bc='ajax/event/delete/'+ac;jQuery.ajaxSetup({global:false});var cc={success:show_results,url:APPLICATION_PREFIX+bc,type:'post',timeout:12000};jQuery('#event-delete-form').ajaxForm(cc);}
function on_event_deleted(dc){close_modal_window();jQuery('#event-'+dc).remove();jQuery('#event-'+dc+"-toolbox").remove();}
function show_results(ec){run_scripts(ec);set_modal_window_contents(ec);}
function enable_buddylist_search(){console.log('enable_buddylist_search');var fc='midcom-exec-org.maemo.calendar/buddylist.php?action=search';jQuery.ajaxSetup({global:false});var gc={beforeSubmit:show_searching,success:render_buddylist_search_results,url:HOST_PREFIX+fc,type:'post',dataType:'json',timeout:12000};jQuery('#buddylist-search-form').ajaxForm(gc);}
function show_searching(){jQuery('#search-indicator').show();jQuery('#buddylist-search-result-count span').html(0);jQuery('#buddylist-search-result-count').hide();jQuery('#buddylist-search-results').html('');}
function render_buddylist_search_results(hc){console.log('render_buddylist_search_results count: '+hc.count);var ic=jQuery('#buddylist-search-results');var jc=function(){return['table',{width:"100%",border:0,cellspacing:0,cellpadding:0},['thead',{},['tr',{},this.header_items],'tbody',{},this.result_items]];};var kc=function(){return['div',{class:"search-message"},this.message];};if(hc.count>0){var lc=jQuery.extend({header_items:[],result_items:[]},hc);console.log('found results!');jQuery('#buddylist-search-result-count span').html(hc.count);jQuery('#buddylist-search-result-count').show();jQuery(ic).tplAppend(lc,jc);}
else{console.log('No results found!');var lc=jQuery.extend({message:''},hc);jQuery(ic).tplAppend(lc,kc);}
jQuery('#search-indicator').hide();}
function remove_item_from_results(mc){console.log("remove_item_from_results: "+mc);var nc=jQuery('#buddylist-search-result-count span')[0].innerHTML;var oc=nc-1;console.log("current_count: "+nc);console.log("new_count: "+oc);jQuery('#buddylist-search-result-count span').html(' '+oc);jQuery('#result-item-'+mc).fadeOut("slow",function(){jQuery('#result-item-'+mc).remove();});}
function add_person_as_buddy(pc){console.log('add_person_as_buddy: '+pc);var qc='ajax/buddylist/add/'+pc;jQuery.ajaxSetup({global:false});jQuery.ajax({type:"GET",url:APPLICATION_PREFIX+qc,timeout:12000,error:function(rc,sc,tc){alert("Failed to add person as buddy! exception type: "+sc);},success:function(uc){console.log('person added as buddy, with message: '+uc);remove_item_from_results(pc);refresh_buddylist();}});}
function remove_person_from_buddylist(vc){console.log('remove_person_from_buddylist: '+vc);var wc='ajax/buddylist/remove/'+vc;jQuery.ajaxSetup({global:false});jQuery.ajax({type:"GET",url:APPLICATION_PREFIX+wc,timeout:12000,error:function(xc,yc,zc){console.log("Failed to remove person from buddylist! exception type: "+yc);},success:function(Ac){jQuery('#buddylist-item-'+vc).fadeOut("slow",function(){jQuery('#buddylist-item-'+vc).remove();});jQuery('#buddylist-item-list').Highlight(800,'#4c4c4c');clean_up_person(vc);console.log('person removed from buddylist, with message: '+Ac);}});}
function refresh_buddylist(Bc){console.log('refresh_buddylist');var Cc='midcom-exec-org.maemo.calendar/buddylist.php?action=refresh_list';var Dc=jQuery("#buddylist-item-list");jQuery.ajaxSetup({global:false});jQuery.ajax({type:"GET",url:HOST_PREFIX+Cc,timeout:12000,error:function(Ec,Fc,Gc){console.log("Failed to refresh buddylist. Exception type: "+Fc);},success:function(r){Dc.html(unescape(r));jQuery('#buddylist-item-list').Highlight(800,'#4c4c4c');console.log("Buddylist refreshed!");if(Bc){var Hc=confirm("You have approved new buddy. We should refresh to get that persons events. Refresh now?");if(Hc){window.location.reload(true);}}}});}
function approve_buddy_request(Ic){console.log('approve_buddy_request: '+Ic);var Jc='ajax/buddylist/action/approve/'+Ic;jQuery.ajaxSetup({global:false});jQuery.ajax({type:"GET",url:APPLICATION_PREFIX+Jc,timeout:12000,error:function(Kc,Lc,Mc){console.log("Failed to approve buddy request! exception type: "+Lc);},success:function(Nc){jQuery('#pending-list-item-'+Ic).fadeOut("slow",function(){jQuery('#pending-list-item-'+Ic).remove();});var Oc=false;if(Nc=='added_new'){Oc=true;}
refresh_buddylist(Oc);console.log('buddy request approved, with message: '+Nc);}});}
function deny_buddy_request(Pc){console.log('deny_buddy_request: '+Pc);var Qc='ajax/buddylist/action/deny/'+Pc;jQuery.ajaxSetup({global:false});jQuery.ajax({type:"GET",url:APPLICATION_PREFIX+Qc,timeout:12000,error:function(Rc,Sc,Tc){console.log("Failed to deny buddy request! exception type: "+Sc);},success:function(Uc){jQuery('#pending-list-item-'+Pc).fadeOut("slow",function(){jQuery('#pending-list-item-'+Pc).remove();});console.log('buddy request denied, with message: '+Uc);}});}
function clean_up_person(Vc){var Wc="#calendar-list-item-"+Vc;jQuery(Wc).remove();var Wc="#calendar-list-item-"+Vc+"-tags";jQuery(Wc).remove();var Wc="#calendar-layer-"+Vc;jQuery(Wc).fadeOut("slow",function(){jQuery(Wc).remove();});}
function edit_calendar_layer_properties(Xc){console.log('edit_calendar_layer_properties layer_id: '+Xc);var Yc='midcom-exec-org.maemo.calendar/layers.php?action=show_update_layer&layer_id='+Xc;load_modal_window(Yc);}
function edit_calendar_layer_tag_properties(Zc,$c){console.log('edit_calendar_layer_tag_properties layer_id: '+Zc+' tag_id: '+$c);var ad='midcom-exec-org.maemo.calendar/layers.php?action=show_update_tag&layer_id='+Zc+'&tag_id='+$c;load_modal_window(ad);}
function enable_layer_update_form(bd,cd){console.log('enable_color_change_form layer_id: '+bd+' tag_id: '+cd);var dd='layer';var ed='midcom-exec-org.maemo.calendar/layers.php?action=update_layer&layer_id='+bd;if(cd!=undefined){dd='layer_tag';ed='midcom-exec-org.maemo.calendar/layers.php?action=update_tag&layer_id='+bd+'&tag_id='+cd;}
jQuery.ajaxSetup({global:false});var fd={beforeSubmit:show_processing,success:processing_successfull,url:HOST_PREFIX+ed,type:'post',timeout:12000};var gd='#update-'+dd+'-form';jQuery(gd).ajaxForm(fd);}
function enable_tag_create_form(hd){url='midcom-exec-org.maemo.calendar/layers.php?action=create_tag&layer_id='+hd;jQuery.ajaxSetup({global:false});var jd={beforeSubmit:show_processing,success:processing_successfull,url:HOST_PREFIX+url,type:'post',timeout:12000};var kd='#create-new_tag-form';jQuery(kd).ajaxForm(jd);}
function show_processing(ld,md,nd){console.log('show_processing');}
function processing_successfull(od,pd){console.log('processing_successfull responseText:'+od);close_modal_window();if(od>0){window.location=window.location;}}
function on_view_update(){hide_shelf_events_from_view();}
function show_layout(){jQuery('#calendar-loading').hide();jQuery('#calendar-holder').show();jQuery('div.application div.header').show();jQuery('#main-panel').show();}
function modify_foreground_color(qd){jQuery.each(jQuery(qd),function(i,n){execute_modify_foreground_color(n);});}
function execute_modify_foreground_color(rd){function bg_to_bits(sd){sd=String(sd);sd=sd.replace(/ /g,'');sd=sd.toLowerCase();var td=[];var ud=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(vd){return[parseInt(vd[1]),parseInt(vd[2]),parseInt(vd[3])];}},{re:/^(\w{2})(\w{2})(\w{2})$/,process:function(wd){return[parseInt(wd[1],16),parseInt(wd[2],16),parseInt(wd[3],16)];}}];for(var i=0;i<ud.length;i++){var re=ud[i].re;var xd=ud[i].process;var yd=re.exec(sd);if(yd){td=xd(yd);}}
td[0]=(td[0]<0||isNaN(td[0]))?0:((td[0]>255)?255:td[0]);td[1]=(td[1]<0||isNaN(td[1]))?0:((td[1]>255)?255:td[1]);td[2]=(td[2]<0||isNaN(td[2]))?0:((td[2]>255)?255:td[2]);return td;}
function RGBToHSL(zd){var Ad,max,delta,h,s,l;var r=zd[0],g=zd[1],b=zd[2];Ad=Math.min(r,Math.min(g,b));max=Math.max(r,Math.max(g,b));delta=max-Ad;l=(Ad+max)/2;s=0;if(l>0&&l<1){s=delta/(l<0.5?(2*l):(2-2*l));}
h=0;if(delta>0){if(max==r&&max!=g)h+=(g-b)/delta;if(max==g&&max!=b)h+=(2+(b-r)/delta);if(max==b&&max!=r)h+=(4+(r-g)/delta);h/=6;}
return[h,s,l];}
bg=jQuery(rd).css('background');if(bg==undefined||bg==""){bg=jQuery(rd).css('background-color');}
if(bg==undefined||bg==""){bg=jQuery(rd).attr('bgcolor');}
if(bg==undefined||bg==""){jQuery(rd).css({color:"#3c3c3c"});return false;}
if(bg.charAt(0)=='#'){bg=bg.substr(1,6);}
var Bd=RGBToHSL(bg_to_bits(bg));var Cd='#ffffff';if(Bd[0]<0.5){Cd='#3c3c3c';}
jQuery(rd).css({color:Cd});}
jQuery(document).ready(function(){jQuery.extend(jQuery.blockUI.defaults.overlayCSS,{backgroundColor:'#b39169'});jQuery('#calendar-loading').ajaxStart(function(){jQuery('#calendar-holder').hide();var Dd=MIDCOM_STATIC_URL+"/org.maemo.calendar/images/indicator.gif";jQuery.blockUI('<img src="'+Dd+'" alt="Loading..." /> Please wait');}).ajaxStop(function(){jQuery.unblockUI();});});