<?xml version="1.0" encoding="UTF-8"?>
<Schema xmlns="http://www.midgard-project.org/repligard/1.4">
    <type name="org_openpsa_salesproject" table="org_openpsa_salesproject" parent="org_openpsa_salesproject" parentfield="up">
        <property name="id" type="integer" primaryfield="id"/>
        <!-- in practise all salesprojects will have up of 0 but in case we someday wish to divide a huge salesproject to subprojects this is here -->
        <property name="up" upfield="up" type="integer"/>

        <property name="start" type="integer"/>
        <property name="end" type="integer"/>
        <property name="title" type="text"/>
        <property name="description" type="text"/>
        <property name="status" type="integer"/>

        <property name="customer" link="midgard_group:id" reverse="no" type="integer"/>
        <!-- Customer contacts are handled as members to project -->

        <property name="owner" link="midgard_person:id" reverse="no" type="integer"/>

        <!-- Common OpenPSA properties -->
        
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        
        <!-- /Common OpenPSA properties -->

        <!-- required metadata -->
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->
    
    </type>

    <type name="org_openpsa_salesproject_member" table="org_openpsa_salesproject_member" parent="org_openpsa_salesproject" parentfield="salesproject">
        <property name="id" type="integer" primaryfield="id"/>
        <property name="person" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="salesproject" link="org_openpsa_salesproject:id" type="integer"/>
        <property name="extra" type="text" />
        <!-- Common OpenPSA properties -->
        
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        
        <!-- /Common OpenPSA properties -->

        <!-- required metadata -->
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->
    </type>

    <type name="org_openpsa_salesproject_deliverable" table="org_openpsa_salesproject_deliverable" parent="org_openpsa_salesproject" parentfield="salesproject">
        <property name="id" type="integer" primaryfield="id"/>
        <property name="up" link="org_openpsa_salesproject_deliverable:id" reverse="no" type="integer"/>
        <property name="product" link="org_openpsa_products_product:id" reverse="no" type="integer"/>
        <property name="salesproject" link="org_openpsa_salesproject:id" type="integer"/>
        <property name="title" type="text"/>
        <property name="description" type="text"/>
        
        <!-- Pricing information. pricePerUnit and unit are the source of calculations but price is the
        definitive price of this deliverable -->
        <property name="price" type="float"/>
        <property name="invoiced" type="float"/>
        <property name="units" type="float"/>
        <property name="plannedUnits" type="float"/>
        <property name="unit" type="text"/>
        <property name="pricePerUnit" type="float"/>
        <property name="invoiceByActualUnits" type="boolean"/>

        <!-- Actual cost of the delivery -->
        <property name="cost" type="float"/>
        <!-- Original planned cost -->
        <property name="plannedCost" type="float"/>
        <!-- Cost per unit, used as basis of calculations for the fields above -->
        <property name="costPerUnit" type="float"/>        
        <property name="costType" type="text"/>
        
        <!-- Start and end can have two different meanings: a) for single deliveries, they are the time when
        delivery can start, and the deadline for it. b) for subscriptions they are the subscription period -->
        <property name="start" type="integer"/>
        <property name="end" type="integer"/>

        <!-- State of the proposal/order -->
        <property name="state" type="integer"/>

        <!-- Common OpenPSA properties -->
        
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        
        <!-- /Common OpenPSA properties -->

        <!-- required metadata -->
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->
    </type>
</Schema>