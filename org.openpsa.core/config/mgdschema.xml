<?xml version="1.0" encoding="UTF-8"?>
<Schema xmlns="http://www.midgard-project.org/repligard/1.4">
<!-- Break up to component specific files with this as 
     Master include point when Piotras has solid support for it -->

    <!-- org.openpsa.contacts Objects-->
    <type name="org_openpsa_organization" table="grp" parentfield="owner">
        <!-- Clean extending not supported yet 
             NewMidgardGrp properties -->
        <property name="id" type="integer" primaryfield="id"/>
        <property name="name" type="text"/>
        <property name="official" type="text"/>
        <property name="homepage" type="text"/>
        <property name="email" type="text"/>
        <property name="extra" type="text"/>
        <property name="owner" link="midgard_group:id" reverse="no" type="integer" />
        <property name="street" type="text"/>
        <property name="postcode" type="text"/>
        <property name="city" type="text"/>
        <!-- /NewMidgardGrp properties -->
        <property name="country" type="text"/>
        
        <!-- GTypes *always* converts underscore to dashes, this sucks even more than CamelCase -->
        <property name="postalStreet" type="text"/>
        <property name="postalPostcode" type="text"/>
        <property name="postalCity" type="text"/>
        <property name="postalCountry" type="text"/>
        
        <property name="invoiceStreet" type="text"/>
        <property name="invoicePostcode" type="text"/>
        <property name="invoiceCity" type="text"/>
        <property name="invoiceCountry" type="text"/>

        <property name="customerId" type="text"/>
        <property name="phone" type="text"/>
        <property name="fax" type="text"/>
        <property name="keywords" type="text"/>

        <!-- Common OpenPSA properties -->

        <!-- Shortcut for various ACL scenarios -->
        <property name="orgOpenpsaAccesstype" type="integer"/>
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- will contain bitmask as integer, 00(int=0) not a workgroup, 01(int=1) is workgroup
             but not active, 11(int=3) active workgroup -->
        <property name="orgOpenpsaWgtype" type="integer"/>
        
        <!-- /Common OpenPSA properties -->
        <!-- required metadata -->
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->        
    </type>
    
    <type name="org_openpsa_person" table="person" parentfield="creator">
        <!-- Clean extending not supported yet 
             midgard_person properties -->
        <property name="id" type="integer" primaryfield="id"/>
        <property name="username" type="text"/>
        <property name="password" type="password"/>
        <property name="firstname" type="text"/>
        <property name="lastname" type="text"/>
        <property name="birthdate" type="text"/>
        <property name="street" type="text"/>
        <property name="postcode" type="text"/>
        <property name="city" type="text"/>
        <property name="homephone" type="text"/>
        <property name="handphone" type="text"/>
        <property name="workphone" type="text"/>
        <property name="homepage" type="text"/>
        <property name="email" type="text"/>
        <property name="extra" type="text"/>
        <property name="img" link="image"/>
        <property name="info" type="string" dbtype="set('auth')"/>
        <property name="topic" link="topic" reverse="no"/>
        <property name="subtopic" link="topic" reverse="no"/>
        <property name="office" link="topic" reverse="no"/>
        <property name="pgpkey" type="text"/>
        <!-- required metadata, confuses old ai
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
             /required metadata -->        
        <!-- /midgard_person properties -->
        
        <property name="country" type="text"/>
        <property name="fax" type="text"/>

        <!-- Common OpenPSA properties -->
        
        <!-- Shortcut for various ACL scenarios -->
        <property name="orgOpenpsaAccesstype" type="integer"/>
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- will contain bitmask as integer, 00(int=0) not a workgroup, 01(int=1) is workgroup
             but not active, 11(int=3) active workgroup -->
        <property name="orgOpenpsaWgtype" type="integer"/>
        
        <!-- /Common OpenPSA properties -->
    </type>                                                                       
    <!-- /org.openpsa.contacts Objects-->
    
    <!-- org.openpsa.documents Objects -->
    <type name="org_openpsa_document" table="org_openpsa_document" parentfield="topic" parent="midgard_topic">
        <!-- Copied from NewMidgardArticle -->
        <property name="id" type="integer" primaryfield="id"/>
        <property name="score" type="integer"/>
        <property name="approved" type="string"/>
        <!-- required metadata -->        
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->        
        <property name="author" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="approver" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="topic" link="topic" type="integer"/>
        <!-- /Copied from NewMidgardArticle -->

        <!-- Does this work as expected (like article->up) ?? -->
        <property name="nextVersion" upfield="nextVersion" type="integer"/>
        <!-- Note: non-ML title -->
        <property name="title" type="text"/>
        <property name="abstract" type="text"/>
        <property name="keywords" type="text"/>
        <!-- For status flags like: DRAFT, etc, could even be a bitmask stored as integer -->
        <!-- status seems to be a reserved word in some layer between DM -> DB -->
        <property name="docStatus" type="integer"/>
        <!-- plaintext representation of content, non-ML -->
        <propetty name="content" type="text"/>
        

        <!-- Common OpenPSA properties -->
        
        <!-- Shortcut for various ACL scenarios -->
        <property name="orgOpenpsaAccesstype" type="integer"/>
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- will contain bitmask as integer, 00(int=0) not a workgroup, 01(int=1) is workgroup
             but not active, 11(int=3) active workgroup -->
        <property name="orgOpenpsaWgtype" type="integer"/>
        <!-- The "owner" workgroup of this object -->
        <property name="orgOpenpsaOwnerWg" type="string"/>
        
        <!-- /Common OpenPSA properties -->
    </type>
    
    <!-- I fear this won't work like this, need to talk with Piotras -->
    <type name="org_openpsa_document_link_organization" table="org_openpsa_document_link" parentfield="">
        <property name="id" type="integer" primaryfield="id"/>
        <property name="did" link="org_openpsa_document:id"/>
        <property name="gid" link="midgard_group:id"/>

        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- will contain bitmask as integer, 00(int=0) not a workgroup, 01(int=1) is workgroup
             but not active, 11(int=3) active workgroup -->
        <property name="orgOpenpsaWgtype" type="integer"/>
        
        <!-- /Common OpenPSA properties -->
    </type>
    <!-- /org.openpsa.documents Objects -->
    
    <!-- org.openpsa.calendar objects -->
    <type name="org_openpsa_event" table="event">
        <!-- Copied from NewMidgardevent -->
        <property name="id" type="integer" primaryfield="id"/>
        <property name="start" type="integer"/>
        <property name="end" type="integer"/>
        <property name="title" type="text"/>
        <property name="description" type="text"/>
        <property name="type" type="integer"/>
        <property name="extra" type="text"/>
        <property name="busy" type="integer"/>
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="locked" type="string"/>
        <property name="owner" link="midgard_group:id" reverse="no" type="integer"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="locker" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="up" upfield="up" type="integer"/>
        <!-- /Copied from NewMidgardevent -->
        
        <property name="location" type="string" />
        <property name="tentative" type="integer" />
        <!-- At least untill we have mRFC 0018 -->
        <property name="externalGuid" type="string" />
        <!-- At least untill we can store arrays with DBA -->
        <property name="vCalSerialized"  type="text" />

        <!-- Common OpenPSA properties -->
        
        <!-- Shortcut for various ACL scenarios -->
        <property name="orgOpenpsaAccesstype" type="integer"/>
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- will contain bitmask as integer, 00(int=0) not a workgroup, 01(int=1) is workgroup
             but not active, 11(int=3) active workgroup -->
        <property name="orgOpenpsaWgtype" type="integer"/>
        <!-- The "owner" workgroup of this object -->
        <property name="orgOpenpsaOwnerWg" type="string"/>
        
        <!-- /Common OpenPSA properties -->
    </type>
    
    <type name="org_openpsa_eventmember" table="eventmember" parent="org_openpsa_event" parentfield="eid">
        <!-- NewMidgardEventmember properties -->
        <property name="id" type="integer" primaryfield="id"/>
        <property name="period" type="integer"/>
        <property name="count" type="integer"/>
        <property name="extra" type="text"/>
        <property name="uid" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="eid" link="org_openpsa_event:id" type="integer"/>
        <!-- /NewMidgardEventmember properties -->

        <property name="sendNotes" type="integer" />
        <property name="hoursReported" type="integer" />

        <!-- Common OpenPSA properties -->
        
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        
        <!-- /Common OpenPSA properties -->

        <!-- required metadata -->        
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->        
    </type>
    
    <!-- /org.openpsa.calendar objects -->
    
    <!-- org.openpsa.queries objects -->
    <type name="org_openpsa_query" table="org_openpsa_query">
        <property name="id" type="integer" primaryfield="id"/>
        <!-- I think these properties will be handled by core in the future -->
        <!-- required metadata -->        
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->        
        
        <!-- title for a report meant for long-term storage -->
        <property name="title" type="string" />
        <!-- start timestamp for report window -->
        <property name="start" type="integer" />
        <!-- end timestamp for report window -->
        <property name="end" type="integer" />
        <!-- style used to display report -->
        <property name="style" type="string" />
        <!-- component this query belongs to -->
        <property name="component" type="string" />
        <!-- component this query is related to -->
        <property name="relatedcomponent" type="string" />
        <!-- mimetype for output (in case it's not 'text/html') -->
        <property name="mimetype" type="string" />
        <!-- file-extension (helps browsers, if not '.html') -->
        <property name="extension" type="string" />
        
        <!-- used to distinguish between temporary and long-term storage -->
        <property name="orgOpenpsaObtype" type="integer"/>
    </type>
    <!-- /org.openpsa.queries objects -->
    
    <!-- org.openpsa.spammer objects  -->
    <type name="org_openpsa_campaign" table="org_openpsa_campaign">
        <property name="id" type="integer" primaryfield="id"/>
        <property name="title" type="text"/>
        <property name="description" type="text"/>

        <!-- required metadata -->        
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->        

        <property name="archived" type="integer" />
        <property name="rulesSerialized" type="text" />


        <!-- Common OpenPSA properties -->
        
        <!-- Shortcut for various ACL scenarios -->
        <property name="orgOpenpsaAccesstype" type="integer"/>
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- will contain bitmask as integer, 00(int=0) not a workgroup, 01(int=1) is workgroup
             but not active, 11(int=3) active workgroup -->
        <property name="orgOpenpsaWgtype" type="integer"/>
        <!-- The "owner" workgroup of this object -->
        <property name="orgOpenpsaOwnerWg" type="string"/>
        
        <!-- /Common OpenPSA properties -->
    </type>

    <type name="org_openpsa_campaign_member" table="org_openpsa_campaign_member" parent="org_openpsa_campaign" parentfield="campaign">
        <property name="id" type="integer" primaryfield="id"/>
        <property name="person" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="campaign" link="org_openpsa_campaign:id" type="integer"/>
        <property name="suspended" type="integer" />
        <!-- Common OpenPSA properties -->
        
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- /Common OpenPSA properties -->
        <!-- required metadata -->        
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->        
    </type>
    
    <type name="org_openpsa_campaign_message" table="org_openpsa_campaign_message" parent="org_openpsa_campaign" parentfield="campaign">
        <property name="id" type="integer" primaryfield="id"/>
        <property name="campaign" link="org_openpsa_campaign:id" type="integer"/>
        <property name="title" type="text"/>
        <property name="description" type="text"/>

        <!-- required metadata -->        
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->        

        <!-- Used for backgrounding the actual sending -->
        <property name="sendStarted" type="integer" />
        <!-- To avoid unneccessary checks against the receipt list and
             more importantly old spam for new campaign members -->
        <property name="sendCompleted" type="integer" />

        <!-- Common OpenPSA properties -->        
        <!-- Shortcut for various ACL scenarios -->
        <property name="orgOpenpsaAccesstype" type="integer"/>
        <!-- Used to a) distinguish OpenPSA objects in QB b) store object "subtype" (project vs task etc) -->
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- The "owner" workgroup of this object -->
        <property name="orgOpenpsaOwnerWg" type="string"/>
        <!-- /Common OpenPSA properties -->
    </type>

    <type name="org_openpsa_campaign_message_receipt" table="org_openpsa_campaign_message_receipt" parent="org_openpsa_campaign_message" parentfield="message">
        <property name="id" type="integer" primaryfield="id"/>
        <property name="message" link="org_openpsa_campaign_message:id" type="integer"/>
        <property name="person" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="token" type="string"/>
        <property name="bounced" type="integer"/>
        <property name="timestamp" type="integer"/>
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- required metadata -->        
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->        
    </type>

    <type name="org_openpsa_link_log" table="org_openpsa_link_log" >
        <property name="id" type="integer" primaryfield="id"/>
        <property name="person" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="message" link="org_openpsa_campaign_message:id" type="integer"/>
        <property name="target" type="string"/>
        <property name="referrer" type="string"/>
        <property name="token" type="string"/>
        <property name="timestamp" type="integer"/>
        <property name="orgOpenpsaObtype" type="integer"/>
        <!-- required metadata -->
        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>
        <!-- /required metadata -->        
    </type>
    
    
    <!-- /org.openpsa.spammer objects  -->
    
    <!-- org.openpsa.tokenlogin objects 
    <type name="org_openpsa_logintoken" table="org_openpsa_logintoken">
        <property name="id" type="integer" primaryfield="id"/>
        <property name="person" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="valid" type="integer"/>
        <property name="used" type="integer"/>
        <property name="ip" type="string"/>
        <property name="token" type="string"/>
        <property name="redirect" type="string"/>

        <property name="revised" type="string"/>
        <property name="revision" type="integer"/>
        <property name="created" type="string"/>
        <property name="creator" link="midgard_person:id" reverse="no" type="integer"/>
        <property name="revisor" link="midgard_person:id" reverse="no" type="integer"/>

    </type>
     /org.openpsa.tokenlogin objects -->
    
</Schema>